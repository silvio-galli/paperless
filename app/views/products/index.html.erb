<h1>
  <%= t 'recurring.products' %>
  <small class="pull-right">
    <%= link_to t('.new_product'), new_product_path, class: 'btn btn-primary' %>
  </small>
</h1>
<br />
<div class="row">
  <div class="col-md-6">
    <div class='search-box'>
      <%= form_tag search_path, method: :get do %>
        <div class="form-group">
          <div class="input-group">
            <span class="input-group-addon">
              <i class="glyphicon glyphicon-search"></i>
            </span>
            <%= text_field_tag 'keyword', nil, autofocus: true, class: 'form-control', placeholder: t('.search_placeholder') %>
        </div>
      <% end %>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-12">
    <table class="table table-hover">
      <thead>
        <tr>
          <th><%= t '.initiative' %></th>
          <th class="description-cell"><%= t '.description' %></th>
          <th><%= t '.arriving_date' %></th>
          <th><%= t '.arriving_quantity' %></th>
          <th><span class="text-green"><%= t '.available_quantity' %></span></th>
          <th><%= t '.local_code' %></th>
          <th><%= t '.default_price' %></th>
          <th><%= t '.promo_price' %></th>
          <th></th>
          <th></th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% @products.each do |product| %>
          <tr>
            <td class="initiative-cell"><%= product.initiative %></td>
            <td class="description-cell">
              <p>
                <%= product_status_label(product, product.arriving_date) %>
                <%= link_to product.description, product %>
              </p>
            </td>
            <% if product.arriving_date %>
              <td><%= I18n.l product.arriving_date, format: :long %></td>
            <% else %>
              <td>nil</td>
            <% end %>
            <td><%= product.quantity %></td>
            <td><%= check_product_availability(product) %></td>
            <td><%= product.local_code %></td>
            <td><%= product.default_price ? sprintf("%.2f €", product.default_price) : nil %></td>
            <td><%= product.promo_price ? sprintf("%.2f €", product.promo_price) : nil %></td>
            <td><%= link_to t('recurring.show'), product_path(product) %></td>
            <td><%= link_to t('recurring.edit'), edit_product_path(product) %></td>
            <%= render partial: "arrived_button", locals: { product: product } %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
